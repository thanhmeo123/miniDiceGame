{"version":3,"sources":["file:///D:/cocos/MiniDiceGame/assets/scripts/core/ScoreManager.ts"],"names":["ScoreManager","constructor","storage","key","window","localStorage","balance","raw","getItem","val","Number","NaN","isNaN","Math","floor","save","change","delta","setItem","String"],"mappings":";;;iBAKaA,Y;;;;;;;;;;;;;8BAAAA,Y,GAAN,MAAMA,YAAN,CAAmB;AAKxBC,QAAAA,WAAW,CAACC,OAAD,EAA6CC,GAA7C,EAAwE;AAAA,cAAvED,OAAuE;AAAvEA,YAAAA,OAAuE,GAAhDE,MAAM,CAACC,YAAyC;AAAA;;AAAA,cAA3BF,GAA2B;AAA3BA,YAAAA,GAA2B,GAArB,mBAAqB;AAAA;;AAAA,eAJ3EA,GAI2E;AAAA,eAH3ED,OAG2E;AAAA,eAFnFI,OAEmF;AACjF,eAAKJ,OAAL,GAAeA,OAAf;AACA,eAAKC,GAAL,GAAWA,GAAX;AAEA,cAAMI,GAAG,GAAG,KAAKL,OAAL,CAAaM,OAAb,CAAqB,KAAKL,GAA1B,CAAZ,CAJiF,CAMjF;;AACA,cAAIM,GAAG,GAAGF,GAAG,KAAK,IAAR,GAAeG,MAAM,CAACH,GAAD,CAArB,GAA6BI,GAAvC,CAPiF,CASjF;;AACA,cAAIC,KAAK,CAACH,GAAD,CAAL,IAAcA,GAAG,GAAG,CAAxB,EAA2B;AACzB,iBAAKH,OAAL,GAAe,IAAf,CADyB,CACJ;AACtB,WAFD,MAEO;AACL,iBAAKA,OAAL,GAAeO,IAAI,CAACC,KAAL,CAAWL,GAAX,CAAf,CADK,CAC2B;AACjC;;AAED,eAAKM,IAAL;AACD;;AAEDC,QAAAA,MAAM,CAACC,KAAD,EAAgB;AACpB,eAAKX,OAAL,IAAgBW,KAAhB;AACA,cAAI,KAAKX,OAAL,GAAe,CAAnB,EAAsB,KAAKA,OAAL,GAAe,CAAf;AACtB,eAAKS,IAAL;AACD;;AAEDA,QAAAA,IAAI,GAAG;AACL,eAAKb,OAAL,CAAagB,OAAb,CAAqB,KAAKf,GAA1B,EAA+BgB,MAAM,CAAC,KAAKb,OAAN,CAArC;AACD;;AAhCuB,O","sourcesContent":["export interface StorageLike {\n  getItem(key: string): string | null;\n  setItem(key: string, value: string): void;\n}\n\nexport class ScoreManager {\n  private key: string;\n  private storage: StorageLike;\n  balance: number;\n\n  constructor(storage: StorageLike = window.localStorage, key = 'mini-dice-balance') {\n    this.storage = storage;\n    this.key = key;\n\n    const raw = this.storage.getItem(this.key);\n\n    // convert safely\n    let val = raw !== null ? Number(raw) : NaN;\n\n    // fallback nếu val là NaN hoặc <0\n    if (isNaN(val) || val < 0) {\n      this.balance = 1000; // điểm mặc định khi bắt đầu\n    } else {\n      this.balance = Math.floor(val); // đảm bảo là số nguyên\n    }\n\n    this.save();\n  }\n\n  change(delta: number) {\n    this.balance += delta;\n    if (this.balance < 0) this.balance = 0;\n    this.save();\n  }\n\n  save() {\n    this.storage.setItem(this.key, String(this.balance));\n  }\n}\n"]}